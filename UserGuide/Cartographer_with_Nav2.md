# Getting Started

This userguide explain on how to establish the communication between Cartographer and Nav2.

## Step 1 - Install following packages
This is required packages for this robot
```
sudo apt-get install ros-humble-turtlebot3*
sudo apt-get install ros-humble-cartographer-ros
sudo apt-get install ros-humble-navigation2 ros-humble-nav2-bringup
```

## Step 2 - Export TURTLEBOT_MODEL
```
sudo vi ~jlukas/.bashrc

and add this line - export TURTLEBOT3_MODEL=waffle

save and quit

source ~jlukas/.bashrc
```

## Step 3 - To launch `Turtlebot3` world
Use below command to run the command
```
ros2 launch turtlebot3-gazebo turtlebot3_world.launch.py
```
This will launch the `gazebo` with turtlebot world. At this point, we haven't generate any of our map.

## Step 4 - Create Launch file for our Map using `Cartographer`
To generate our map using Cartographer, below packages is considered
```
ros2 run cartographer_ros cartographer_node
ros2 run cargographer_occupancy_grid_node
```

To make things easy we'll add above `packages` into our `launch` file namely `mapping.launch.py`

Please remember. For `ros2 run cartographer_ros cartographer_node`, it expect `-configuration_directory` for `config_dir`  and `-configuration_basename` for `turtlebot3_lds_2d.lua`. You can find this information in `cartographer` package below.
```
https://github.com/cartographer-project/cartographer_ros/blob/master/cartographer_ros/cartographer_ros/node_main.cc
```
For `turtlebot3_lds_2d.lua` you can download or copy contents of this package from
```
https://github.com/ROBOTIS-GIT/turtlebot3/blob/humble-devel/turtlebot3_cartographer/config/turtlebot3_lds_2d.lua
```
and copy it over to `config` directory of the launch file. 

In this file we're interested at `map_frame`, `published_frame` and `tracking_frame`.

Please ensure you have included `config` file in `setup.py`.
Then run:
```
colcon build 
```

## Step 5 - Launch our `mapping.launch.py` to generate map
Use below command to start
```
ros2 launch ros2_cartographer_nav2 mapping.launch.py
```

This will open `rviz2`. From here, select following configuration:
```
fixed_frame = map
map = topic --> /map (Here we can see the map)
```

Next run `Gazebo` to simulate our robot.
```
ros2 launch turtlebot3_gazebo turtlebot3_world.launch.py
```

Next run `teleop_twist_keyboard` using below command to move our robot.
```
ros2 run teleop_twist_keyboard teleop_keyboard
```

Then press the control button to `start mapping`. Please ensure you have a clean boundaries of the mapping for good guality map.

## Step 6 - Save the `Generated Map`
Use below command to save the map as `tb3_world`
```
ros2 run nav2_map_server map_saver_cli -f src/ros2_cartographer_nav2/config/tb3_world
```

Now you see the saved `map` in `config` with following format
```
tb3_world.pgm
tb3_world.yaml
```

## Step 7 - Create Launch file for our `Nav2`

To start create `navigation.launch.py` in `launch` directory.
To start navigation, we're going to implement below Node
```
- Bringing our robot
- Integrating Nav2 stack
- Rviz2 bringup
```

Kindly noted, for `Nav2` arguments, `map` and `params_file` are required. Description as follow:
```
map_file --> This is generated by mapping.launch.py file that we did earlier
         --> `tb3_world.yaml`
         --> This file under `config`

params_file --> This is copied from turtlebot git page at turtlebot3_navigation/param/waffle.yaml
            --> Visit https://github.com/ROBOTIS-GIT/turtlebot3/blob/humble-devel/turtlebot3_navigation2/param/waffle.yaml
            --> waffle.yaml
            --> This file under `param` directory

rviz_config --> This is copied from turtlebot git page at turtlebot2_navigation/rviz/tb3_navigation2.rviz
            --> Visit https://github.com/ROBOTIS-GIT/turtlebot3/blob/humble-devel/turtlebot3_navigation2/rviz/tb3_navigation2.rviz
            --> tb3_navigation2.rviz
            --> This file under `rviz2` directory
```

Then run 
```
colcon build
. /install/setup.bash
```

## Step 8 - Launch our `Nav2` file `navigation.launch.py` as follow:
Run below launch launch file to start with `Navigation`
```
ros2 launch ros2_cartographer_nav2 navigation.launch.py 
```
This will launch `rviz2` and `Gazebo`.

Select `2D pose estimate` to localize correct direction of our `robot`. You will see correct map layout orientation.

To start with `navigation`, select `nav2 to goal` and define the direction.

